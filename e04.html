<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>複合検索のみにした</title>
        <link rel="stylesheet" type="text/css" href="test.css">
   </head>
    <body class="search">

      <h1>複合検索のみにした</h1>  

        <div id="container_complex" class="container_search">

            <div class="container_complex_and">
                <h2>AND</h2>
                <table id="tag_index_container">
                    <tr>
                        <th class="tag_index_group">グループ</th>
                        <th class="tag_index_tag">タグ</th>
                    </tr>
                    <tr>
                        <td class="tag_index_group">猫</td>
                        <td class="tag_index_tag">
                            <input type="button" value="猫1" class="tag">
                            <input type="button" value="猫2" class="tag">
                            <input type="button" value="猫3" class="tag">
                            <input type="button" value="猫4" class="tag">
                            <input type="button" value="猫5" class="tag">
                        </td>
                    </tr>
                </table>
                <input type="text" value="" class="selected_tag_inputted">
            </div>

            <div class="container_complex_or">
                <h2>OR</h2>
                <table id="tag_index_container">
                    <tr>
                        <th class="tag_index_group">グループ</th>
                        <th class="tag_index_tag">タグ</th>
                    </tr>
                    <tr>
                        <td class="tag_index_group">猫</td>
                        <td class="tag_index_tag">
                            <input type="button" value="猫1" class="tag">
                            <input type="button" value="猫2" class="tag">
                            <input type="button" value="猫3" class="tag">
                            <input type="button" value="猫4" class="tag">
                            <input type="button" value="猫5" class="tag">
                        </td>
                    </tr>
                </table>
                <input type="text" value="" class="selected_tag_inputted">
            </div>

            <div class="complex_button">
                <a href="" class="button button_search">複合検索</a>
                <button class="button button_clear">リセット</button>
            </div>

        </div>



        <script>



const array = ["猫1,猫2,猫3," , "猫1,猫3,猫4," , "猫1,猫2,猫5," , "猫2,猫3,猫4," , "猫1,猫4,猫5,"];

window.onload = ()=> {
    const containerAnd = document.querySelector('.container_complex_and');
    const containerOr = document.querySelector('.container_complex_or');
    const clearButton = document.querySelector('.button_clear');
    const searchButton = document.querySelector('.button_search');

    const andTags = containerAnd.querySelectorAll('.tag');
    const orTags = containerOr.querySelectorAll('.tag');
    const andSelectedTagInputted = containerAnd.querySelector('.selected_tag_inputted');
    const orSelectedTagInputted = containerOr.querySelector('.selected_tag_inputted');

    andTags.forEach((tag) => {
        tag.addEventListener('click', () => selectTagToggleComplex(tag, andSelectedTagInputted, searchButton) );
    });
    orTags.forEach((tag) => {
        tag.addEventListener('click', () => selectTagToggleComplex(tag, orSelectedTagInputted, searchButton) );
    });

    clearButton.addEventListener('click', () => { 
        clearSelectedTags(andTags, andSelectedTagInputted, searchButton);
        clearSelectedTags(orTags, orSelectedTagInputted, searchButton);
    });

    // ブラウザバックした際に隠れinputをクリアする
    window.addEventListener('pageshow', ()=> {
        andSelectedTagInputted.value = "";
        orSelectedTagInputted.value = "";
    });    
};

// タグの選択状態を切り替え、リンクをセットする関数
function selectTagToggleComplex(tag, inputField, searchButton) {
    const tagValue = encodeURIComponent(tag.value);
    const selectedTags = inputField.value.split('+');

    if (!selectedTags.includes(tagValue)) {
        inputField.value += tagValue + "+";
    } else {
        inputField.value = inputField.value.replace(`${tagValue}+`, "");
    };

    tag.classList.toggle('select_tag');

    const setLinkAnd = document.querySelector('.container_complex_and').querySelector('.selected_tag_inputted').value.replace(/\+$/, "");
    const setLinkOr = document.querySelector('.container_complex_or').querySelector('.selected_tag_inputted').value.replace(/\+$/, "");

    if (setLinkAnd !== "" && setLinkOr === ""){
        searchButton.setAttribute('href', `results?and=${setLinkAnd}`)
    } else if (setLinkAnd === "" && setLinkOr !== ""){
        searchButton.setAttribute('href', `results?or=${setLinkOr}`)
    } else if (setLinkAnd === "" && setLinkOr === ""){
        searchButton.setAttribute('href', '')
    } else{
        searchButton.setAttribute('href', `results?and=${setLinkAnd}&or=${setLinkOr}`)
    };
};

// 選択されたタグ、リンクをクリアする関数
function clearSelectedTags(tags, inputField, searchButton) {
    tags.forEach((tag) => {
        tag.classList.remove('select_tag');
    });
    inputField.value = "";
    searchButton.removeAttribute('href');
};









        </script>
        
        <footer><a href="./">テスト一覧へ戻る</a></footer>        
    </body>
</html>